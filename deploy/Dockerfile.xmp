# XMP API 数据采集 - Cloud Run Jobs 镜像
# 轻量级镜像，通过 API 获取数据，不需要浏览器
FROM python:3.11-slim

# 设置工作目录
WORKDIR /app

# 安装依赖
RUN pip install --no-cache-dir \
    requests \
    python-dotenv \
    google-cloud-bigquery

# 复制代码文件
COPY xmp/ ./xmp/
COPY config/ ./config/
COPY bigquery_storage.py .
COPY utils/ ./utils/

# 设置环境变量
ENV PYTHONUNBUFFERED=1
ENV CLOUD_RUN=true

# 运行脚本 (默认拉取昨日数据并上传)
CMD ["python", "-m", "xmp.xmp_campaign_report", "--upload"]
